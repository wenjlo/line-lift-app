<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID æŸ¥è©¢å·¥å…·</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
            text-align: center;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 400px;
            margin-bottom: 20px;
        }
        img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid #06C755;
        }
        h2 { margin: 10px 0; color: #333; }
        h3 { margin: 20px 0 5px 0; color: #555; font-size: 16px; border-bottom: 2px solid #eee; padding-bottom: 5px; display: inline-block;}
        p { color: #666; margin-bottom: 5px; font-size: 14px; }

        .id-box {
            background: #eee;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 15px;
            color: #d32f2f;
            word-break: break-all;
            margin: 10px 0 15px 0;
            border: 1px dashed #999;
        }

        .no-group {
            color: #888;
            font-style: italic;
            background: #f9f9f9;
        }

        .btn {
            background-color: #06C755;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        .btn:active { background-color: #05b34c; transform: scale(0.98); }
        .btn-secondary { background-color: #666; }

        #status { margin-top: 5px; color: #06C755; font-size: 14px; height: 20px; font-weight: bold;}
    </style>
</head>
<body>

    <div class="card" id="content" style="display:none;">
        <img id="profileImage" src="" alt="Profile">
        <h2 id="displayName">è¼‰å…¥ä¸­...</h2>

        <h3>ğŸ‘¤ å€‹äºº User ID</h3>
        <div class="id-box" id="userIdDisplay">...</div>
        <button class="btn" onclick="copyText('userIdDisplay')">ğŸ“‹ è¤‡è£½ User ID</button>

        <h3>ğŸ‘¥ ç›®å‰ç¾¤çµ„ Group ID</h3>
        <div class="id-box" id="groupIdDisplay">è®€å–ä¸­...</div>
        <button class="btn btn-secondary" id="groupBtn" onclick="copyText('groupIdDisplay')" disabled>ğŸ“‹ è¤‡è£½ Group ID</button>

        <div id="status"></div>
    </div>

    <div id="loading">æ­£åœ¨è®€å–è¨­å®šæª”...</div>

<script>
        // å®£å‘Šè®Šæ•¸ï¼Œç¨å¾Œå¾ JSON å¡«å…¥
        let NEW_LIFF_ID = "";

        async function main() {
            try {
                // ==========================================
                // 1. è®€å– config.json
                // ==========================================
                // åŠ ä¸Š timestamp é˜²æ­¢ç€è¦½å™¨å¿«å–
                const configRes = await fetch(`config.json?t=${new Date().getTime()}`);

                if (!configRes.ok) {
                    throw new Error("æ‰¾ä¸åˆ° config.json");
                }

                const config = await configRes.json();

                // ğŸ”´ ä¿®æ”¹é€™è£¡ï¼šè®€å– "userIDLiffId" è€Œä¸æ˜¯ "liffId"
                NEW_LIFF_ID = config.userIDLiffId;

                // æª¢æŸ¥æ˜¯å¦æˆåŠŸè®€å–åˆ°
                if (!NEW_LIFF_ID) {
                    throw new Error("config.json ä¸­æ‰¾ä¸åˆ° userIDLiffId");
                }

                // é¡¯ç¤ºç‹€æ…‹
                document.getElementById('loading').textContent = "æ­£åœ¨åˆå§‹åŒ– LIFF...";

                // ==========================================
                // 2. åˆå§‹åŒ– LIFF
                // ==========================================
                await liff.init({ liffId: NEW_LIFF_ID });

                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // ==========================================
                // 3. å–å¾— User Profile
                // ==========================================
                const profile = await liff.getProfile();
                document.getElementById('profileImage').src = profile.pictureUrl || "https://via.placeholder.com/80";
                document.getElementById('displayName').textContent = profile.displayName;
                document.getElementById('userIdDisplay').textContent = profile.userId;

                // ==========================================
                // 4. å–å¾— Group Context
                // ==========================================
                const context = liff.getContext();
                const groupBox = document.getElementById('groupIdDisplay');
                const groupBtn = document.getElementById('groupBtn');

                if (context && context.type === 'group') {
                    // ç¾¤çµ„
                    groupBox.textContent = context.groupId;
                    groupBox.classList.remove('no-group');

                    groupBtn.disabled = false;
                    groupBtn.style.backgroundColor = "#00B900";
                    groupBtn.textContent = "ğŸ“‹ è¤‡è£½ Group ID";

                } else if (context && context.type === 'room') {
                    // å¤šäººèŠå¤©å®¤
                    groupBox.textContent = context.roomId;
                    groupBox.classList.remove('no-group');
                    groupBtn.disabled = false;
                    groupBtn.style.backgroundColor = "#00B900";
                    groupBtn.textContent = "ğŸ“‹ è¤‡è£½ Room ID";

                } else {
                    // å…¶ä»–ç’°å¢ƒ
                    groupBox.textContent = "âš ï¸ è«‹åœ¨ç¾¤çµ„å…§é–‹å•Ÿé€£çµä»¥å–å¾— Group ID";
                    groupBox.classList.add('no-group');
                    groupBtn.disabled = true;
                    groupBtn.style.backgroundColor = "#ccc";
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

            } catch (err) {
                document.getElementById('loading').innerHTML = "ç™¼ç”ŸéŒ¯èª¤ï¼š<br>" + err;
                console.error(err);
            }
        }

        // è¤‡è£½åŠŸèƒ½ (ç¶­æŒä¸è®Š)
        function copyText(elementId) {
            const text = document.getElementById(elementId).textContent;
            if (text.includes("âš ï¸")) return;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showStatus("âœ… è¤‡è£½æˆåŠŸï¼");
                }).catch(err => {
                    manualCopy(text);
                });
            } else {
                manualCopy(text);
            }
        }

        function manualCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showStatus("âœ… è¤‡è£½æˆåŠŸï¼");
        }

        function showStatus(msg) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = msg;
            setTimeout(() => {
                statusEl.textContent = "";
            }, 2000);
        }

        main();
    </script>
</body>
</html>